openapi: 3.0.3
info:
  title: Todo App API - Authentication
  description: |
    Authentication endpoints for Phase II Todo Application.
    Supports user registration, login, logout, and profile retrieval.
  version: 1.0.0
  contact:
    name: API Support
    email: support@todoapp.example.com

servers:
  - url: http://localhost:8000/api
    description: Local development server
  - url: https://api.todoapp.example.com/api
    description: Production server

tags:
  - name: Authentication
    description: User authentication and session management

paths:
  /auth/register:
    post:
      summary: Register a new user
      description: |
        Create a new user account with email and password credentials.
        Passwords are hashed using bcrypt before storage.
        Returns the created user object (without password hash).
      operationId: registerUser
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegisterRequest'
            examples:
              basic:
                summary: Basic registration
                value:
                  email: user@example.com
                  password: SecurePass123!
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
              examples:
                success:
                  summary: Successful registration
                  value:
                    id: 550e8400-e29b-41d4-a716-446655440000
                    email: user@example.com
                    created_at: '2026-01-07T12:00:00Z'
        '400':
          description: Bad request (invalid email format or password too short)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidEmail:
                  summary: Invalid email format
                  value:
                    error: Invalid email format
                shortPassword:
                  summary: Password too short
                  value:
                    error: Password must be at least 8 characters
        '409':
          description: Conflict (email already registered)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                duplicateEmail:
                  summary: Email already exists
                  value:
                    error: Email already registered
        '422':
          description: Validation error (missing or invalid fields)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
              examples:
                missingFields:
                  summary: Missing required fields
                  value:
                    error: Validation failed
                    detail:
                      - loc: [body, email]
                        msg: field required
                        type: value_error.missing

  /auth/login:
    post:
      summary: Authenticate user and get JWT token
      description: |
        Authenticate with email and password credentials.
        Returns a JWT access token valid for 24 hours and user information.
      operationId: loginUser
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLoginRequest'
            examples:
              basic:
                summary: Basic login
                value:
                  email: user@example.com
                  password: SecurePass123!
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              examples:
                success:
                  summary: Successful login
                  value:
                    access_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAiLCJleHAiOjE3MDQ4MjA4MDAsImlhdCI6MTcwNDczNDQwMH0.signature
                    token_type: bearer
                    user:
                      id: 550e8400-e29b-41d4-a716-446655440000
                      email: user@example.com
        '401':
          description: Unauthorized (invalid credentials)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidCredentials:
                  summary: Invalid email or password
                  value:
                    error: Invalid email or password
        '422':
          description: Validation error (missing fields)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'

  /auth/logout:
    post:
      summary: Logout user (client-side token invalidation)
      description: |
        Logout endpoint that confirms token validity before clearing session.
        Actual token invalidation happens on the client side.
      operationId: logoutUser
      tags:
        - Authentication
      security:
        - BearerAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties: {}
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
              examples:
                success:
                  summary: Successful logout
                  value:
                    message: Logged out successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /auth/me:
    get:
      summary: Get current authenticated user profile
      description: |
        Retrieve the profile of the currently authenticated user.
        User ID is extracted from the JWT token.
      operationId: getCurrentUser
      tags:
        - Authentication
      security:
        - BearerAuth: []
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
              examples:
                success:
                  summary: Current user profile
                  value:
                    id: 550e8400-e29b-41d4-a716-446655440000
                    email: user@example.com
                    created_at: '2026-01-07T12:00:00Z'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: User not found (user ID from token doesn't exist)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                userNotFound:
                  summary: User not found
                  value:
                    error: User not found

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token obtained from /auth/login endpoint.
        Include in Authorization header as: "Bearer {token}"

  schemas:
    # Request Models
    UserRegisterRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          maxLength: 255
          description: User's email address (used for login)
          example: user@example.com
        password:
          type: string
          format: password
          minLength: 8
          maxLength: 128
          description: User's password (min 8 characters)
          example: SecurePass123!

    UserLoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: Registered email address
          example: user@example.com
        password:
          type: string
          format: password
          description: User's password
          example: SecurePass123!

    # Response Models
    UserResponse:
      type: object
      required:
        - id
        - email
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique user identifier
          example: 550e8400-e29b-41d4-a716-446655440000
        email:
          type: string
          format: email
          description: User's email address
          example: user@example.com
        created_at:
          type: string
          format: date-time
          description: Account creation timestamp (ISO 8601 UTC)
          example: '2026-01-07T12:00:00Z'

    AuthResponse:
      type: object
      required:
        - access_token
        - token_type
        - user
      properties:
        access_token:
          type: string
          description: JWT access token (valid for 24 hours)
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAiLCJleHAiOjE3MDQ4MjA4MDAsImlhdCI6MTcwNDczNDQwMH0.signature
        token_type:
          type: string
          description: Token type (always "bearer")
          example: bearer
        user:
          $ref: '#/components/schemas/UserResponse'

    MessageResponse:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Success message
          example: Logged out successfully

    # Error Models
    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: Error message describing what went wrong
          example: Invalid email or password

    ValidationErrorResponse:
      type: object
      required:
        - error
        - detail
      properties:
        error:
          type: string
          description: High-level error message
          example: Validation failed
        detail:
          type: array
          items:
            type: object
            properties:
              loc:
                type: array
                items:
                  oneOf:
                    - type: string
                    - type: integer
                description: Location of the error (path to the invalid field)
                example: [body, email]
              msg:
                type: string
                description: Error message
                example: field required
              type:
                type: string
                description: Error type identifier
                example: value_error.missing

  responses:
    UnauthorizedError:
      description: Unauthorized (missing, invalid, or expired token)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            missingToken:
              summary: Missing Authorization header
              value:
                error: Authorization header required
            invalidToken:
              summary: Invalid or malformed token
              value:
                error: Invalid token
            expiredToken:
              summary: Token has expired
              value:
                error: Token expired
