# OpenAPI Contract: AI-Powered Todo Chat API

## Overview
This document defines the API contracts for the AI-powered todo interface, based on the functional requirements from the feature specification.

## API Endpoints

### POST /api/{user_id}/chat

**Summary**: Process natural language chat requests from users and return AI-generated responses with task operations

**Path Parameters**:
```
user_id: string (required)
  description: Unique identifier of the authenticated user
  format: uuid
```

**Headers**:
```
Authorization: string (required)
  description: Bearer token for user authentication
  example: "Bearer eyJhbGciOiJIUzI1NiIs..."
Content-Type: string (required)
  description: Content type for request body
  example: "application/json"
Accept: string (required)
  description: Expected response format
  example: "application/json"
```

**Request Body**:
```json
{
  "type": "object",
  "properties": {
    "message": {
      "type": "string",
      "description": "The natural language message from the user",
      "minLength": 1,
      "maxLength": 10000,
      "example": "Add a task to buy groceries tomorrow"
    },
    "conversation_id": {
      "type": "string",
      "format": "uuid",
      "description": "Optional ID of the conversation to continue (creates new if omitted)",
      "example": "a1b2c3d4-e5f6-7890-1234-567890abcdef"
    },
    "metadata": {
      "type": "object",
      "description": "Additional context or metadata for the request (optional)",
      "properties": {
        "timezone": {
          "type": "string",
          "description": "User's timezone for date/time processing",
          "example": "America/New_York"
        },
        "locale": {
          "type": "string",
          "description": "User's preferred locale",
          "example": "en-US"
        }
      }
    }
  },
  "required": ["message"],
  "additionalProperties": false
}
```

**Success Response (200 OK)**:
```json
{
  "type": "object",
  "properties": {
    "success": {
      "type": "boolean",
      "const": true,
      "description": "Indicates whether the operation was successful"
    },
    "conversation_id": {
      "type": "string",
      "format": "uuid",
      "description": "ID of the conversation (newly created or continued)",
      "example": "a1b2c3d4-e5f6-7890-1234-567890abcdef"
    },
    "response": {
      "type": "string",
      "description": "The AI-generated response to the user's message",
      "example": "I've added the task 'Buy groceries' to your list for tomorrow."
    },
    "actions_taken": {
      "type": "array",
      "description": "List of actions performed as a result of natural language processing",
      "items": {
        "type": "object",
        "properties": {
          "action": {
            "type": "string",
            "enum": ["task_created", "task_updated", "task_completed", "task_deleted", "list_returned", "none"],
            "description": "Action performed as a result of the natural language processing"
          },
          "details": {
            "type": "object",
            "description": "Specific details about the action taken"
          }
        },
        "required": ["action", "details"]
      }
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when the response was generated",
      "example": "2026-01-17T15:30:45.123Z"
    }
  },
  "required": ["success", "conversation_id", "response", "actions_taken", "timestamp"],
  "additionalProperties": false
}
```

**Example Success Response**:
```json
{
  "success": true,
  "conversation_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "response": "I've added the task 'Buy groceries' to your list for tomorrow.",
  "actions_taken": [
    {
      "action": "task_created",
      "details": {
        "task_id": "f0e9d8c7-b6a5-4321-fedc-ba9876543210",
        "title": "Buy groceries",
        "due_date": "2026-01-18T00:00:00Z"
      }
    }
  ],
  "timestamp": "2026-01-17T15:30:45.123Z"
}
```

**Error Response (400 Bad Request)**:
```json
{
  "type": "object",
  "properties": {
    "success": {
      "type": "boolean",
      "const": false,
      "description": "Indicates that the operation failed"
    },
    "error": {
      "type": "string",
      "description": "Error message describing what went wrong",
      "example": "Invalid request parameters"
    },
    "error_code": {
      "type": "string",
      "description": "Machine-readable error code",
      "example": "INVALID_REQUEST"
    }
  },
  "required": ["success", "error", "error_code"],
  "additionalProperties": false
}
```

**Unauthorized Response (401)**:
```json
{
  "type": "object",
  "properties": {
    "success": {
      "type": "boolean",
      "const": false,
      "description": "Indicates that the operation failed"
    },
    "error": {
      "type": "string",
      "description": "Error message indicating authentication failure",
      "example": "Authentication required"
    },
    "error_code": {
      "type": "string",
      "description": "Machine-readable error code",
      "example": "UNAUTHORIZED"
    }
  },
  "required": ["success", "error", "error_code"],
  "additionalProperties": false
}
```

**Forbidden Response (403)**:
```json
{
  "type": "object",
  "properties": {
    "success": {
      "type": "boolean",
      "const": false,
      "description": "Indicates that the operation failed"
    },
    "error": {
      "type": "string",
      "description": "Error message indicating access forbidden",
      "example": "Access to requested resource is forbidden"
    },
    "error_code": {
      "type": "string",
      "description": "Machine-readable error code",
      "example": "FORBIDDEN_ACCESS"
    }
  },
  "required": ["success", "error", "error_code"],
  "additionalProperties": false
}
```

## Security Requirements

### Authentication
- All requests must include a valid JWT token in the Authorization header
- Token must be validated against Better Auth service
- User context extracted from token claims

### Authorization
- Users can only access their own data
- User ID in path parameter must match authenticated user
- Conversation and task access validated against user ownership

## Rate Limiting

### Limits
- 100 requests per minute per user
- 1000 requests per minute per IP (unauthenticated)

### Headers
```
X-RateLimit-Limit: integer
  description: Request limit per time window
X-RateLimit-Remaining: integer
  description: Remaining requests in current time window
X-RateLimit-Reset: string
  description: Time when rate limit resets (RFC 3339 format)
```

## Content Negotiation

### Request Content Types
- application/json: Standard JSON requests

### Response Content Types
- application/json: Standard JSON responses

## Versioning
- API version: v1 (embedded in path as /api/v1/...)
- Backward compatibility maintained for minor version changes
- Breaking changes introduced with new major version

## Validation

### Request Validation
- All request parameters and bodies validated according to schema
- Invalid requests return 400 Bad Request with detailed error messages
- Required fields checked and documented

### Response Validation
- All responses conform to documented schema
- Error responses include appropriate error codes
- Success responses include all required fields

## Examples

### Example 1: Adding a Task
**Request**:
```
POST /api/a1b2c3d4-e5f6-7890-1234-567890ab/user-id/chat
Authorization: Bearer token
Content-Type: application/json

{
  "message": "Add a task to call mom tomorrow at 7pm",
  "metadata": {
    "timezone": "America/New_York"
  }
}
```

**Response**:
```json
{
  "success": true,
  "conversation_id": "c5d4e3f2-1a0b-9c8d-7e6f-5a4b3c2d1e0f",
  "response": "I've added the task 'Call mom' to your list for tomorrow at 7:00 PM.",
  "actions_taken": [
    {
      "action": "task_created",
      "details": {
        "task_id": "f0e9d8c7-b6a5-4321-fedc-ba9876543210",
        "title": "Call mom",
        "due_date": "2026-01-18T19:00:00Z"
      }
    }
  ],
  "timestamp": "2026-01-17T15:30:45.123Z"
}
```

### Example 2: Listing Tasks
**Request**:
```
POST /api/a1b2c3d4-e5f6-7890-1234-567890ab/user-id/chat
Authorization: Bearer token
Content-Type: application/json

{
  "message": "Show me what I have to do today"
}
```

**Response**:
```json
{
  "success": true,
  "conversation_id": "c5d4e3f2-1a0b-9c8d-7e6f-5a4b3c2d1e0f",
  "response": "Here are your tasks for today:\n1. Call mom (High priority)\n2. Buy groceries\n3. Finish report (Due today)",
  "actions_taken": [
    {
      "action": "list_returned",
      "details": {
        "task_count": 3,
        "tasks": [
          {"id": "task1", "title": "Call mom", "priority": "high"},
          {"id": "task2", "title": "Buy groceries", "priority": "medium"},
          {"id": "task3", "title": "Finish report", "priority": "high"}
        ]
      }
    }
  ],
  "timestamp": "2026-01-17T15:31:22.456Z"
}
```